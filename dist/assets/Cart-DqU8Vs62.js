import{j as s,L as m,F as $,A as F,u as p,G as h,r as i,H as E,I as x,J as S,E as j,K as H,M as D,N as R}from"./index-BB63jZdJ.js";const L=({cartItem:t,incrementHandler:o,decrementHandler:d,removeHandler:a})=>s.jsx(s.Fragment,{children:s.jsxs("div",{className:"cart-item",children:[s.jsx("img",{src:`http://localhost:4000/uploads/${t.photo}`,alt:"product image"}),s.jsxs("div",{className:"cart-item-info",children:[s.jsxs("div",{className:"cart-item-name",children:[s.jsx(m,{to:`/product/${t.productId}`,children:t.name}),s.jsx("p",{children:`₹${t.price}`})]}),s.jsxs("div",{className:"cart-item-btns",children:[s.jsx("button",{onClick:()=>d(t),children:"-"}),s.jsx("span",{children:t.quantity}),s.jsx("button",{onClick:()=>o(t),children:"+"}),s.jsx("button",{onClick:()=>a(t.productId),children:s.jsx($,{})})]})]})]})}),Q=()=>{const t=F(),{user:o,loading:d}=p(e=>e.userReducer),a=o?._id,{token:O,cancel:C}=h.CancelToken.source(),{subTotal:g,tax:y,shippingCharges:f,total:k,discount:l,cartItems:r}=p(e=>e.cartReducer);i.useEffect(()=>{t(E())},[r,t]);const[c,v]=i.useState(""),[N,u]=i.useState(!1);i.useEffect(()=>{const e=setTimeout(()=>{h.get(`http://localhost:4000/api/v1/payment/discount?coupon=${c}`).then(n=>{t(x(n.data.discount)),u(!0)}).catch(()=>{t(x(0)),C(),u(!1)})},1e3);return()=>{clearTimeout(e)}},[c]);const q=e=>{if(e.quantity>=e.stock)return;t(S({...e,quantity:e.quantity+1}));const{productId:n}=e;t(j({userId:a,productId:n,quantity:1}))},T=e=>{if(e.quantity<=1)return;t(H({...e,quantity:e.quantity-1}));const{productId:n}=e;t(j({userId:a,productId:n,quantity:-1}))},b=e=>{t(D(e)),t(R({userId:a,productId:e}))};return s.jsx(s.Fragment,{children:s.jsxs("div",{className:"cart",children:[s.jsx("main",{children:s.jsx(s.Fragment,{children:r.map((e,n)=>s.jsx(L,{cartItem:e,incrementHandler:q,decrementHandler:T,removeHandler:b},n))})}),s.jsxs("aside",{children:[s.jsxs("p",{children:["SubTotal : ₹",g]}),s.jsxs("p",{children:["ShippingCharges : ₹",f]}),s.jsxs("p",{children:["Tax : ₹",y]}),s.jsxs("p",{children:["Discount : ",s.jsx("span",{className:"red",children:`-₹${l}`})]}),s.jsxs("b",{children:["Total : ₹",k]}),s.jsx("input",{type:"text",placeholder:"coupon code",value:c,onChange:e=>{v(e.target.value)}}),c&&(N?s.jsxs("p",{className:"green",children:[l," off using the coupon code ",s.jsx("code",{children:c})]}):s.jsx("p",{className:"red",children:"invalid coupon"})),r.length>0&&s.jsx("p",{children:s.jsx(m,{className:"checkout-link",to:"/shipping",children:"CheckOut"})})]})]})})};export{Q as default};
